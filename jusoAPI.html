<!DOCTYPE HTML>
<html>

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=10, user-scalable=yes">

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


    <script type="text/javascript" src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="./js/proj4.js"></script>

    <title>주소 API</title>
    <script type="text/javascript">
        var timeObj = null;
        var transformPointForWgs = function (x, y) {
            proj4.defs('EPSG:5179', '+proj=tmerc +lat_0=38 +lon_0=127.5 +k=0.9996 +x_0=1000000 +y_0=2000000 +ellps=GRS80 +units=m +no_defs');

            var ep1 = new proj4.Proj('EPSG:5179');
            var ep2 = new proj4.Proj('EPSG:4326');
            var p = new proj4.Point(parseFloat(x), parseFloat(y));
            var trans = proj4.transform(ep1, ep2, p);

            return [trans.x, trans.y];
        };

        $(function () {
            $('#flag').on('change', function () {
                $(this).val() == 'coord' ? $('#item').show() : $('#item').hide();
                $(this).val() == 'coord' ? $('#coord').show() : $('#coord').hide();
            });

            $('#btn').on('click', function () {
                $('#result').html('');
                var text = $('#searchText').val();
                var splitTxt = text.split(',');

                var i = 0;

                if (timeObj) {
                    clearInterval(timeObj);
                }

                timeObj = setInterval(function () {
                    if ((i + 1) >= splitTxt.length) {
                        clearInterval(timeObj);
                    }

                    $.ajax({
                        url: 'https://www.juso.go.kr/addrlink/addrLinkApiJsonp.do'
                        , type: 'POST'
                        , data: {
                            confmKey: 'U01TX0FVVEgyMDE4MTIxMTE2MzYyNDEwODM2MTE=',
                            currentPage: 1,
                            countPerPage: 1,
                            keyword: splitTxt[i],
                            resultType: 'json'
                        }
                        , dataType: 'jsonp'
                        , crossDomain: true
                        , success: function (jsonStr) {
                            var split = splitTxt[i];
                            var flag = $('#flag').val();
                            if (flag == 'coord') {
                                if (jsonStr.results.juso) {
                                    if (jsonStr.results.juso.length > 0) {
                                        var paramObj = jsonStr.results.juso[0];
                                        $.ajax({
                                            url: 'https://www.juso.go.kr/addrlink/addrCoordApiJsonp.do'
                                            , type: 'POST'
                                            , data: {
                                                confmKey: 'U01TX0FVVEgyMDE5MDUyMTE0MTMwODEwODc0NDI=',
                                                admCd: paramObj.admCd,
                                                rnMgtSn: paramObj.rnMgtSn,
                                                udrtYn: paramObj.udrtYn,
                                                buldMnnm: paramObj.buldMnnm,
                                                buldSlno: paramObj.buldSlno,
                                                resultType: 'json'
                                            }
                                            , dataType: 'jsonp'
                                            , crossDomain: true
                                            , success: function (jsonStr) {
                                                var val = $('#item').val();
                                                var coord = $('#coord').val();

                                                var str = '';

                                                if (coord == '4326') {
                                                    var trans = transformPointForWgs(jsonStr.results.juso[0].entX, jsonStr.results.juso[0].entY);
                                                    jsonStr.results.juso[0].entX = trans[0];
                                                    jsonStr.results.juso[0].entY = trans[1];
                                                }
                                                if (val == 'x') {
                                                    str = jsonStr.results.juso[0].entX;
                                                } else if (val == 'y') {
                                                    str = jsonStr.results.juso[0].entY;
                                                } else {
                                                    str = jsonStr.results.juso[0].entX + ',' + jsonStr.results.juso[0].entY;
                                                }

                                                $('#result').append(str + '<br/>');
                                            }
                                        });
                                    } else {
                                        $('#result').append((i + 1) + '. ' + splitTxt[i] + ' - ' + 'X' + '<br />');
                                    }
                                } else {
                                    $('#result').append((i + 1) + '. ' + splitTxt[i] + ' - ' + 'X' + '<br />');
                                }

                                i++;
                            } else {
                                if (jsonStr.results.juso) {
                                    if (jsonStr.results.juso.length > 0) {
                                        $('#result').append(jsonStr.results.juso[0].jibunAddr + '<br />');
                                    } else {
                                        $('#result').append((i + 1) + '. ' + splitTxt[i] + ' - ' + 'X' + '<br />');
                                    }
                                } else {
                                    $('#result').append((i + 1) + '. ' + splitTxt[i] + ' - ' + 'X' + '<br />');
                                }

                                i++;
                            }
                        }
                        , error: function (xhr, status, error) {
                        }
                    });

                }, 1000);

            })
        });

    </script>
</head>

<body>
    <input id="searchText" type="text" />
    <select id="flag">
        <option value="juso">주소</option>
        <option value="coord">좌표</option>
    </select>
    <select id="coord" style="display: none;">
        <option value="5179">EPSG:5179</option>
        <option value="4326">EPSG:4326</option>
    </select>
    <select id="item" style="display: none;">
        <option value="x">x</option>
        <option value="y">y</option>
        <option value="both">x,y</option>
    </select>
    <input id="btn" type="button" value="변환" />
    <div> ================================================= <br />
        1. 한줄로 <br />
        2. 쉼표로 연결 (인천광역시 연수구 테크노파크로 200,인천광역시 연수구 테크노파크로 200)<br />
        =================================================
    </div>
    <div id="result">
    </div>
</body>

</html>